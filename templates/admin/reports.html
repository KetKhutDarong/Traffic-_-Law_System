<!-- {% extends "base.html" %}

{% block title %}Admin Reports - Traffic Law Expert{% endblock %}

{% block content %}
<h2 class="mb-4">
    <i class="fas fa-chart-line"></i> Violation Reports
</h2>

<div class="row mb-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-calendar"></i> Daily Violations (Last 30 Days)
            </div>
            <div class="card-body">
                <canvas id="dailyChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-car"></i> Violations by Vehicle Type
            </div>
            <div class="card-body">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-table"></i> Detailed Breakdown
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Vehicle Type</th>
                                <th>Total Violations</th>
                                <th>Total Fines</th>
                                <th>Average Fine</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cat in category_stats %}
                            <tr>
                                <td><strong>{{ cat.vehicle_type }}</strong></td>
                                <td><span class="badge bg-info">{{ cat.count }}</span></td>
                                <td><span class="badge bg-success">${{ cat.total_fine }}</span></td>
                                <td>${{ (cat.total_fine / cat.count)|int }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <button class="btn btn-primary">
            <i class="fas fa-download"></i> Export as PDF
        </button>
        <button class="btn btn-success">
            <i class="fas fa-file-excel"></i> Export as Excel
        </button>
    </div>
</div>

<script>
// Daily violations chart
const dailyCtx = document.getElementById('dailyChart').getContext('2d');
const dailyData = {{ daily_violations | tojson }};

new Chart(dailyCtx, {
    type: 'line',
    data: {
        labels: dailyData.map(d => d.date),
        datasets: [{
            label: 'Daily Violations',
            data: dailyData.map(d => d.count),
            borderColor: '#007bff',
            backgroundColor: 'rgba(0, 123, 255, 0.1)',
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: true,
                position: 'top'
            }
        }
    }
});

// Category violations chart
const categoryCtx = document.getElementById('categoryChart').getContext('2d');
const categoryData = {{ category_stats | tojson }};

new Chart(categoryCtx, {
    type: 'bar',
    data: {
        labels: categoryData.map(c => c.vehicle_type),
        datasets: [{
            label: 'Count',
            data: categoryData.map(c => c.count),
            backgroundColor: '#28a745'
        }]
    },
    options: {
        responsive: true,
        indexAxis: 'y',
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
</script>
{% endblock %} -->
